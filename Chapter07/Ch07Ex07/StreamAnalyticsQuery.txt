WITH BrainwaveWindowResults AS
( 
SELECT
    System.Window().Id AS WindowId,
    System.TimeStamp() AS IngestionTime,
    PERCENTILE_CONT(0.5) OVER (ORDER BY brainwaves.ALPHA) AS medianAPLHA,
    PERCENTILE_CONT(0.5) OVER (ORDER BY brainwaves.BETA_H) AS medianBETA_H,
    PERCENTILE_CONT(0.5) OVER (ORDER BY brainwaves.BETA_L) AS medianBETA_L,
    PERCENTILE_CONT(0.5) OVER (ORDER BY brainwaves.GAMMA) AS medianGAMMA,
    PERCENTILE_CONT(0.5) OVER (ORDER BY brainwaves.THETA) AS medianTHETA
FROM brainwaves
GROUP BY WindowId, IngestionTime, 
         Windows(
     		Window('5 seconds', TumblingWindow(second, 5)),
     		Window('10 seconds', HoppingWindow(second, 10, 5)),
     		Window('20 seconds', HoppingWindow(second, 20, 5)),
     		Window('30 seconds', HoppingWindow(second, 30, 5)))
)
SELECT BrainwaveWindowResults.* INTO synapse FROM BrainwaveWindowResults
